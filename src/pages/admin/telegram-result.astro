---
import Layout from "@/layouts/Layout.astro";
import { CheckCircle2, XCircle, AlertTriangle } from "lucide-react";

// Obtener parámetros de la URL
const url = new URL(Astro.request.url);
const success = url.searchParams.get('success'); // 'confirmed' o 'rejected'
const error = url.searchParams.get('error');
const product = url.searchParams.get('product');
const amount = url.searchParams.get('amount');

const isConfirmed = success === 'confirmed';
const isRejected = success === 'rejected';
const hasError = !!error;
---

<Layout title="Resultado Telegram - Admin">
  <div class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-4">
    <div class="max-w-md w-full">
      {isConfirmed && (
        <div class="bg-slate-800/50 rounded-2xl border border-green-500/30 p-8 text-center">
          <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce-once">
            <CheckCircle2 className="w-10 h-10 text-white" />
          </div>
          <h1 class="text-2xl font-bold text-white mb-2">¡Pago Confirmado!</h1>
          <p class="text-gray-400 mb-4">El código ha sido asignado al cliente.</p>
          
          {product && (
            <div class="bg-slate-900/50 rounded-lg p-4 mb-6">
              <p class="text-sm text-gray-400">Producto</p>
              <p class="text-lg font-semibold text-white">{product}</p>
              {amount && (
                <p class="text-primary font-bold">${Number(amount).toLocaleString('es-CO')}</p>
              )}
            </div>
          )}

          <div class="space-y-3">
            <a 
              href="/admin/pagos" 
              class="block w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-xl font-medium transition-all"
            >
              Ver Panel de Pagos
            </a>
            <p class="text-xs text-gray-500">Puedes cerrar esta ventana y volver a Telegram</p>
          </div>
        </div>
      )}

      {isRejected && (
        <div class="bg-slate-800/50 rounded-2xl border border-red-500/30 p-8 text-center">
          <div class="w-20 h-20 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-6">
            <XCircle className="w-10 h-10 text-white" />
          </div>
          <h1 class="text-2xl font-bold text-white mb-2">Pago Rechazado</h1>
          <p class="text-gray-400 mb-6">La compra ha sido marcada como rechazada.</p>

          <a 
            href="/admin/pagos" 
            class="block w-full bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-medium transition-all"
          >
            Ir al Panel
          </a>
        </div>
      )}

      {hasError && (
        <div class="bg-slate-800/50 rounded-2xl border border-yellow-500/30 p-8 text-center">
          <div class="w-20 h-20 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
            <AlertTriangle className="w-10 h-10 text-yellow-500" />
          </div>
          <h1 class="text-xl font-bold text-white mb-2">Algo salió mal</h1>
          <p class="text-red-400 mb-6 font-medium">{error}</p>

          <a 
            href="/admin/pagos" 
            class="block w-full bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-medium transition-all"
          >
            Volver al Panel
          </a>
        </div>
      )}
    </div>
  </div>
</Layout>
